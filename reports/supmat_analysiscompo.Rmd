---
title: "Simulation of log fitness change"
author: "Laure Olazcuaga, Nicolas Rode"
date: "`r format(Sys.Date(), '%d-%B-%Y')`"
output: 
  html_document:
    theme: "journal"
    toc: true
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false
editor_options: 
  chunk_output_type: console
---


```{r setup, include =FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
devtools::load_all()
```


# DATA
## Load data
```{r }
## Data longitudinal 
data_sum_allfruits <- loadlongitudinaldata_allfruits(dataset = "DATA_Adults_G1G29.csv", rm_generation_max = 5)
data_sum_allfruits_AN<-data_sum_allfruits[data_sum_allfruits$Generation!=1,]


#Data compo
data_compo<-read.table(file=here::here("data", "Data_compo_fruits.csv"), sep=",", header=TRUE)
rownames(data_compo) <- data_compo[,1]
data_compo$Treatment<-as.factor(data_compo$Treatment)

```


# ACP
```{r }
## Make PCA
PCA <- FactoMineR::PCA(data_compo[,-c(1,2)], graph=FALSE)

## Check eigenvalues and percentage of variance explained
eig.val <- factoextra::get_eigenvalue(PCA)
eig.val
factoextra::fviz_eig(PCA)






#pdf(file="PCA.pdf")
## Check position of individuals
Ind_plot <- factoextra::fviz(PCA, element="ind", pointsize = 3, 
                   labelsize = 4, #change the size of the pop label
                   invisible = "quali",
                  show.legend = FALSE, pointshape = 21, fill = "#00AFBB",
                  repel = TRUE) + #remove centroid
  theme_LO_sober 
Ind_plot         



factoextra::fviz_pca_biplot(PCA, label = "var", habillage=data_compo$Treatment)

VARIABLES_Plot<-factoextra::fviz_pca_var(PCA, col.var = "contrib",
                                         gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                                         repel = TRUE) + theme_LO_sober
VARIABLES_Plot


## Check indiivduals
ind <- factoextra::get_pca_ind(PCA)
ind

# Coordonnées des individus
head(ind$coord)
# Qualité des individus
head(ind$cos2)
# Contributions des individus
head(ind$contrib)

factoextra::fviz_pca_ind(PCA, col.ind = "#00AFBB",
   repel = TRUE)


factoextra::fviz_pca_ind (PCA, col.ind = data_compo[,1] ,
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE)


factoextra::fviz_pca_ind (PCA, pointsize = "cos2",
             pointshape = 21, fill = "#E7B800",
             repel = TRUE )

```
